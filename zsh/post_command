# use growl to report that a long-running command has finished
# using code from http://blog.tobez.org/posts/how_to_time_command_execution_in_zsh/

note_remind=0
note_ignore="yes"
note_command="?"

note_report(){
  /usr/local/bin/growlnotify --appIcon 'Terminal' --sticky --message "$note_command is compelete."
}

preexec(){
  if [ "x$TTY" != "x" ]; then
      note_remind="$SECONDS"
      note_ignore=""
      note_command="$2"
  fi
}

precmd(){
  local xx
  if [ "x$TTY" != "x" ]; then
    if [ "x$note_ignore" = "x" ]; then
      note_ignore="yes"
      xx=$(($SECONDS-$note_remind))
      if [ $xx -gt $REPORTTIME ]; then
        if [ $TTYIDLE -gt $REPORTTIME ]; then
          note_report $xx
        fi
      fi
    fi
  fi
}
